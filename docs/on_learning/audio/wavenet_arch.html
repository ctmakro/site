<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <script>
      (function() {
      var method;
      var methods = [
          'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error',
          'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log',
          'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd',
          'timeline', 'timelineEnd', 'timeStamp', 'trace', 'warn'
      ];
      var length = methods.length;
      var console = (window.console = window.console || {});
      while (length--) {
          method = methods[length];
          // Only stub undefined methods.
          if (!console[method]) {
              console[method] = function () {};
          }
      }
      }());
      
      
    </script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="./../../basic.css" rel="stylesheet" type="text/css">
    <link rel="shortcut icon" href="./../../favicon.ico">
    <title> Behind WaveNet</title>
  </head>
  <body id="body">
    <div class="navigation_area">
      <div class="navnode">
              <div class="navnode_title">/</div>
              <div class="navnode"><a href="./../../index.html">Index</a>
              </div>
              <div class="navnode"><a href="./../../bio.html">About</a>
              </div>
              <div class="navnode">
                      <div class="navnode_title">/lit</div>
                      <div class="navnode"><a href="./../../lit/why_bad_idea.html">Why Smart People Have Bad Ideas</a>
                      </div>
              </div>
              <div class="navnode">
                      <div class="navnode_title">/on_learning</div>
                      <div class="navnode"><a href="./../../on_learning/tf1c.html"> Compile TF 1.0</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/course_resources.html">Learning Resources</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/fast_gan_in_keras.html"> Fast DCGAN in Keras</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/gan.html">GAN 生成式对抗网络</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/gd.html">Gradient Descent 梯度下降法</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/artist.html">Training of Artists</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/how_to.html">Baby steps for ML</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/resnet_keras.html">Residual Network in Keras</a>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/audio</div>
                              <div class="navnode"><a href="./../../on_learning/audio/wavenet_arch.html"> Behind WaveNet</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/image</div>
                              <div class="navnode"><a href="./../../on_learning/image/fast_lsgan.html">Fast LSGAN in Canton</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/image/style_transfer.html">On Style Transfer 风格转移</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/motor_model</div>
                              <div class="navnode"><a href="./../../on_learning/motor_model/motor.html">Learn models of motors</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/npeg</div>
                              <div class="navnode"><a href="./../../on_learning/npeg/npeg.html">NPEG图像压缩</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/activations</div>
                              <div class="navnode"><a href="./../../on_learning/activations/index.html">Activation Functions</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/activations/relu.html">Rectified Linear Unit 整流线性单元</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/rl</div>
                              <div class="navnode"><a href="./../../on_learning/rl/bipedal.html">BipedalWalker-v2</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/rl/ddpg.html">DDPG Method</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/rl/rl.html">RL is progressing rapidly</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/gru</div>
                              <div class="navnode"><a href="./../../on_learning/gru/gru.html">GRU and Convolutional GRU</a>
                              </div>
                      </div>
              </div>
              <div class="navnode">
                      <div class="navnode_title">/on_life</div>
                      <div class="navnode"><a href="./../../on_life/beijing.html">北京收获</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/electrical.html">Power System Analysis</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/lang.html"> 编程语言的选择</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/nocode.html"> 不写码 No Code</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/numjs.html">NumJs</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/reprod.html"> 确定性</a>
                      </div>
              </div>
      </div>
    </div>
    <div class="markdown_content"><h1 data-sourcepos="3:1-3:16">Behind WaveNet</h1>
<p data-sourcepos="5:1-5:169">WaveNet <a href="https://arxiv.org/pdf/1609.03499.pdf">https://arxiv.org/pdf/1609.03499.pdf</a> is a convolutional neural network architecture that takes a bunch of audio samples as input, and predicts the next sample.</p>
<p data-sourcepos="7:1-7:21"><img src="wavenet_arch.png" alt="" /></p>
<p data-sourcepos="9:1-9:69">It worked so well(speech generation, music audio generation), so why?</p>
<h2 data-sourcepos="11:1-11:18">My explaination</h2>
<p data-sourcepos="13:1-13:251">Any audio signal can be synthesized with a collection of sine waves(or wavelets) of different frequencies. If we know the frequency, phase and amplitude of each of the sine waves(or wavelets), it is trivial to predict the amplitude of the next sample.</p>
<p data-sourcepos="15:1-15:395">Just like the image shown above: two sinewave S1 and S2 are marked in red and blue, given their frequency <code>f</code>, phase <code>theta</code> and amplitude <code>A</code>, predicting their next sample would be as simple as calculating <code>Asin((2pi + theta) * f)</code>. So if we could decompose the incoming audio signal into a bunch of sinewaves, predicting the next sample would be as easy as <code>sum(sin(each sinewave parameters))</code></p>
<p data-sourcepos="17:1-17:152">WaveNet does EXACTLY that, but in the neural network way (so nonlinearties of various kind could be added and trained to deal with real world problems).</p>
<ol data-sourcepos="19:1-44:0">
<li data-sourcepos="19:1-26:0">
<p data-sourcepos="19:4-19:179">assume the input signal s1+s2 is being sampled at a frequency of <code>fs</code>, and the L1-L2 convolution kernel(drawn in cyan) is sensitive to the difference between two input samples.</p>
<p data-sourcepos="21:5-21:35"><img src="wavenet_arch_demo_conv.png" alt="" /></p>
<p data-sourcepos="23:5-23:132">obviously, after the L1-L2 convolution, signal of frequency <code>fs/2</code> (like the blue S2) will produce high activation (<code>b0</code>) in L2.</p>
<p data-sourcepos="25:5-25:85">L2 can now say, &quot;I saw a signal of frequency <code>fs/2</code> of amplitude <code>b0 = a0 - a1</code>&quot;.</p>
</li>
<li data-sourcepos="27:1-32:0">
<p data-sourcepos="27:4-27:175">L1 may also pass bias (common part of <code>a0</code> and <code>a1</code>) information to L2, using convolution kernels (drawn in purple) that are sensitive to the sum between two input samples.</p>
<p data-sourcepos="29:5-29:34"><img src="wavenet_arch_demo_res.png" alt="" /></p>
<p data-sourcepos="31:5-31:73">L2 can now say, &quot;apart of that, I also saw a bias of <code>r0 = a0 + b0</code>&quot;.</p>
</li>
<li data-sourcepos="33:1-38:0">
<p data-sourcepos="33:4-33:124">then after the L2-L3 convolution, signal of frequency <code>fs/4</code> (like the red S1) will produce high activation (<code>b1</code>) in L3.</p>
<p data-sourcepos="35:5-35:35"><img src="wavenet_arch_demo_res2.png" alt="" /></p>
<p data-sourcepos="37:5-37:85">L3 can now say, &quot;I saw a signal of frequency <code>fs/4</code> of amplitude <code>b1 = r0 - r1</code>&quot;.</p>
</li>
<li data-sourcepos="39:1-40:0">
<p data-sourcepos="39:4-39:180">so if we repeat this structure <code>N</code> times, we can extract the amplitude(and phase, won't go into detail here) information of sinewaves of frequency <code>fs/2, fs/4, fs/8 ... fs/2^N</code>.</p>
</li>
<li data-sourcepos="41:1-44:0">
<p data-sourcepos="41:4-41:196">Then in order to predict the next sample using functions like <code>sum(sin(each sinewave parameters))</code>, we feed information from different frequencies to the output, using skip connections(yellow).</p>
<p data-sourcepos="43:5-43:36"><img src="wavenet_arch_demo_skips.png" alt="" /></p>
</li>
</ol>
<p data-sourcepos="45:1-45:365">So the idea here is simple: decompose incoming waveform into different frequencies, extract parameters(amplitude and phase), then predict the next sample based on the parameters. So you might ask, why don't they just use FFT, or other well-established frequency domain analysis method??? Since after all, their 1D dilated convolutions are just doing the job of DFT.</p>
<p data-sourcepos="47:1-47:169">I don't know either, but Facebook just found out how to do 2D convolution with FFT (<a href="https://github.com/facebook/fbcunn">https://github.com/facebook/fbcunn</a>), so the same thing could happen to WaveNet too.</p>
<h2 data-sourcepos="49:1-49:44">Original description in the WaveNet paper</h2>
<p data-sourcepos="51:1-51:239">As I explained above, those &quot;skip connections&quot; are required since the prediction network won't function without information from those connections. However, DeepMind gave very few comments on &quot;skip connections&quot;, describing it like a trick:</p>
<p data-sourcepos="53:1-53:27"><img src="wavenet_arch_paper.png" alt="" /></p>
</div>
    <div class="meta_string">
      <p>file: wavenet_arch.md</p>
      <p>last modified: 2017-02-09 23:33</p>
    </div>
    <script>
      //if(window.HighlightEverything){window.HighlightEverything()}
      
    </script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/atom-one-light.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
      
    </script>
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  </body>
</html>